<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROUTEGUESSR</title>
    <link href="{{ url_for('static', filename='styles/single_result_style.css')}}" rel = "stylesheet"/>
    <link rel="icon" type="image/png" href="../static/images/ROUTEGUESSR.png">
</head>
<body>
    <section class="back">
        <div class="text-box">
            <div class="content-container">
                <div class="route-info">
                    <div class="image-container">
                        <img src="{{ image_url }}" alt="Route Image">
                    </div>
                </div>
                <div class="map-container">
                    <div class = "map-box">
                        <div id="map"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class = "score-box">
            <p>Wow! Your pin was {{ distance }} kilometers away from the route!</p>
            <a href = "{{ route_url }}" target="_blank"> Route Page</a>
        </div>
    </section>
    <script>
        const userLat = {{ user_lat }}; // {{ user_lat }}
        const userLon = {{ user_lon }}; // {{ user_lon }}
        const routeLat = {{ route_lat }};
        const routeLon = {{ route_lon }};
        const userPosition = { lat: userLat, lng: userLon };
        const routePosition = { lat: routeLat, lng: routeLon };


        let map;

        async function initMap() {
            const { Map } = await google.maps.importLibrary("maps");

            map = new Map(document.getElementById("map"), {
                center: { lat: {{ avg_lat }}, lng: {{ avg_lon }} },
                zoom: {{ zoom_level }},
                streetViewControl: false,
                rotateControl: false,
                fullscreenControl: true,
                clickableIcons: false,
                mapTypeId: google.maps.MapTypeId.TERRAIN
            });

            const userMarker = new google.maps.Marker({
                position: userPosition,
                map: map,
                title: "Your Guess",
                icon: {
                    url: "../static/images/man.png",
                    scaledSize: new google.maps.Size(32,32)
                }
            });

            const routeMarker = new google.maps.Marker({
                position: routePosition,
                map: map,
                title: "Actual Route Location",
                icon: {
                    url: "../static/images/home.png",
                    scaledSize: new google.maps.Size(32,32)
                }
            });

            const line = new google.maps.Polyline({
                path: [userPosition, routePosition],
                geodesic: true,
                strokeColor: "#333333",
                strokeOpacity: 0,
                strokeWeight: 0,
                icons: [{
                    icon: {
                        path: 'M 0,-1 0,1',
                        strokeOpacity: 1,
                        strokeColor: '#333333',
                        scale: 3
                    },
                    offset: '5%',
                    repeat: '15px'
                }]
            });

            line.setMap(map);
        }

        initMap();
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_key }}&callback=initMap" async defer></script>
</body>
</html>